适应MTL架构、当前AI友好型，按一定格式记录LOG，对传统工程维护也有好处


always  – 只要写日志就带
error  – 日志级别 ≥ error 才带
panic  – 只有 panic/fatal 才带（可自动触发，也可手动）
sample  – 按采样比例决定是否带（比如 1‰）

---

### 0. 基础字段（顶层）表
| 字段 | 级别   | 说明                                                         | 示例                          |
|------|--------|--------------------------------------------------------------|-------------------------------|
| t    | always | 人类可读时间，统一 UTC 的 RFC3339，含时区偏移              | `"2023-12-09T15:04:05.123Z"`  |
| ts   | always | Unix 时间戳（毫秒），用于排序、窗口计算，绝对 UTC           | `1702122245123`               |
| lv  | always | 日志级别，枚举：TRACE/DEBUG/INFO/WARN/ERROR/PANIC/FATAL     | `"PANIC"`                     |

### 1. runtime 字段表
| 字段        | 级别   | 说明                                                         | 示例                                |
|-------------|--------|--------------------------------------------------------------|-------------------------------------|
| caller      | always | 文件:行号，编译期注入                                        | `"order/service.go:87"`             |
| err         | error  | 系统原始错误文本；无错误时 omit                              | `"record not found"`                |
| fault       | panic  | 故障现场对象，仅 panic/fatal 时出现，见下                    | `{"stack":[...],"deploy":{...}}`    |

### 1.1 runtime.fault 子表
| 字段        | 级别   | 说明                                                         | 示例                                |
|-------------|--------|--------------------------------------------------------------|-------------------------------------|
| stack       | panic  | 调用栈数组，最多 10 层，防止爆量                             | `["order/service.go:87","inv/client.go:112"]` |
| deploy      | panic  | 故障瞬间的部署快照，内容与原顶层 deploy 一致，见下           | `{ "service":"order-svc", ... }`    |

### 1.2 runtime.fault.deploy 子表
| 字段      | 级别   | 说明                                         | 示例                          |
|-----------|--------|----------------------------------------------|-------------------------------|
| service   | panic  | 服务名                                       | `"order-svc"`                 |
| version   | panic  | 镜像/代码版本                                | `"v2.1.0-12-g5c3b2e1"`        |
| region    | panic  | 云地域                                       | `"cn-shanghai"`               |
| az        | panic  | 可用区                                       | `"cn-shanghai-f"`             |
| cluster   | panic  | 集群 ID                                      | `"k8s-prod-01"`               |
| pod       | panic  | Pod 名（容器场景）                           | `"order-svc-7d4d8b6c5-m8pqr"` |
| node      | panic  | 宿主机 IP 或 hostname                        | `"10.244.1.7"`                |
| namespace | panic  | 命名空间                                     | `"ns-12345"`                  |

### 2. trace 字段表
| 字段       | 级别   | 说明                                           | 示例                                 |
|------------|--------|------------------------------------------------|--------------------------------------|
| trace_id   | always | W3C TraceId，32-hex 小写                       | `"4bf92f3577b34da6a3ce929d0e0e4736"` |
| span_id    | always | 当前 SpanId，16-hex 小写                       | `"00f067aa0ba902b7"`                 |
| sampled    | always | 是否被采样                                     | `true`                               |
| parent_id  | error  | 父 span，16-hex                                | `"b7f0456f0cd1248a"`                 |
| tracestate | sample | vendor 透传字段，采样 1%                       | `"rojo=00f067aa0ba902b7"`            |

### 3. request 字段表
| 字段         | 级别   | 说明                                         | 示例                          |
|--------------|--------|----------------------------------------------|-------------------------------|
| method       | always | HTTP 方法                                    | `"POST"`                      |
| route        | always | 原始路由模板                                 | `"/api/v1/order/:id"`         |
| status       | always | 响应状态码                                   | `500`                         |
| remote_ip    | error  | 客户端公网 IP                                | `"112.65.3.24"`               |
| request_len  | error  | 请求体字节数                                 | `612`                         |
| response_len | error  | 响应体字节数                                 | `78`                          |
| duration_ms  | always | 总耗时                                       | `523`                         |
| user_agent   | sample | UA，截断 200 字符                            | `"Mozilla/5.0 (Linux; Android 10)..."` |
| country      | sample | GeoIP 国家                                   | `"CN"`                        |
| header       | error  | 仅出错时记录关键首部（可裁减）               | `{"x-request-id":"a1b2c3"}`   |
| body         | error  | 仅出错时记录解析后 body（限大小/脱敏）       | `{"sku":"123456","num":2}`    |

### 4. response 字段表
| 字段   | 级别   | 说明                                         | 示例                      |
|--------|--------|----------------------------------------------|---------------------------|
| code   | always | 业务字典返回码                               | `1000`                    |
| msg    | always | 业务返回描述                                 | `"err msg or ok/success"` |
| data   | always | 业务 payload，无数据时为空对象               | `{"coupon":"NEW80"}`      |


完整示例：

```json
{
  "t": "2023-12-09T15:04:05.123Z",
  "ts": 1702122245123,
  "lv": "PANIC",

  "runtime": {
    "caller": "order/service.go:87",
    "err": "record not found", //系统提示的错误信息
    “break”: {
      "stack": [
        "order/service.go:87",
        "inventory/client.go:112"
      ],
      "deploy": {
	    "service": "order-svc",
	    "version": "v2.1.0-12-g5c3b2e1",
	    "region": "cn-shanghai",
	    "az": "cn-shanghai-f",
	    "cluster": "k8s-prod-01",
	    "pod": "order-svc-7d4d8b6c5-m8pqr",
	    "node": "10.244.1.7",
	    "namespace": "ns-12345"
  },

  "trace": {
    "trace_id": "4bf92f3577b34da6a3ce929d0e0e4736",
    "span_id": "00f067aa0ba902b7",
    "sampled": true,
    "parent_id": "b7f0456f0cd1248a",
    "tracestate": "rojo=00f067aa0ba902b7"
  },

  "request": {
    "method": "POST",
    "route": "/api/v1/order/:id",
    "status": 500,
    "remote_ip": "112.65.3.24",
    "request_len": 612,
    "response_len": 78,
    "duration_ms": 523,
    "user_agent": "Mozilla/5.0 (Linux; Android 10)...",
    "country": "CN",
    "header": "x-request-id=a1b2c3", //http-header
    "body": {"sku":"123456","num":2} //http-body json源文？
  },

  "response": {
	"code": 1000, //采用字典
	"msg": "err msg or ok/success",
    "data": {
      "coupon": "NEW80"
    }
  }
}
```


